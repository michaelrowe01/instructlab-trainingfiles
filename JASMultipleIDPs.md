META:TOPICINFO{author="shubjit" date="1700039853" format="1.1"
reprev="1.10" version="1.10"}
META:TOPICPARENT{name="JazzAuthorizationServer"}

# Configuring ELM Authentication with Multiple Third Party OIDC Providers DKGRAY Authors: Main.ShubjitNaik Build basis: Engineering Lifecycle Management 7.0.2 or higher [configuring-elm-authentication-with-multiple-third-party-oidc-providers-dkgray-authors-main.shubjitnaik-build-basis-engineering-lifecycle-management-7.0.2-or-higher]

ENDCOLOR

TOC{title="Page contents"}

There are requirements where ELM has to be deployed in an environment
for users from different companies to collaborate. And in this scenario
the end users would need to authenticate against different IDPs which
could be their respective company owned IDPs. Can we configure multiple
Identity Providers with IBM Engineering Lifecycle Management Solution?

A general example of this pattern is to configure a Liberty server so
that users can authenticate to websites that are hosted on the Liberty
server by logging in with their social media account. You can choose
from the predefined social media platform configurations, or define your
own configuration for any social media platform that is based on the
OAuth 2.0 or OpenID Connect standards.

You can setup ELM to authenitcate via [Jazz Authorization
Server](JazzAuthorizationServer) (JAS) which is based on WebSphere
Application Server Liberty. And using the
[SocialLogin](https://www.ibm.com/docs/en/was-liberty/core?topic=liberty-configuring-social-login-in)
feature a Liberty server can be configured to further delegate the user
authentication to Third Party OIDC Provider. **If multiple OIDC
Providers are configured to protect a request, Liberty provides a
default selection form that offers you the option to choose between the
available OIDC providers configured in the Liberty server**. Visit
Liberty [Social Media Selection
Form](https://www.ibm.com/docs/en/was-liberty/core?topic=liberty-social-media-selection-form)
for additional information.

The focus on this article is on configuring Multiple Third party OIDC
Providers in JAS using the Social Login feature and the Liberty default
Social Media selection form.

## Configure JAS and User Group Role Mapping

First step is to configure ELM and JAS. You would need to either
configure JAS with multiple LDAPs, one each for a Third Party OIDC
Provider, or a consolidated LDAP server which has a copy of all the
Users from multiple OIDC Providers.

-   To configure multiple LDAPs in JAS you would need to enable SCIM.
    Visit [Configure Multiple User Registries with JAS and
    SCIM](JASSCIMFederatedRepositories)
-   To configure a single LDAP with JAS Visit [Configure JAS with an
    LDAP User Registry](JASUserRegistryConfig)

User Groups to Jazz Roles mappings (JazzAdmins, JazzUsers etc) are
picked from JTS configuration when configured with JAS. When Users
accesses an ELM application URL, they are redirected to JAS for
Authentication. Post successful authentication JTS performs one of the
following:

-   When configured with SCIM, JTS does the group lookup via the SCIM
    URL and groups provided under JTS Admin \> Advanced Properties \>
    -   `com.ibm.team.repository.service.jts.internal.userregistry.scim.SCIMUserRegistryProvider`
        for User group to Jazz role mappings
-   When configured with LDAP, JTS does a group lookup via an ldapsearch
    Query against the LDAP and group details mentioned under JTS Admin
    \> Advanced Properties \>
    -   `com.ibm.team.repository.service.jts.internal.userregistry.ldap.LDAPUserRegistryProvider`
        for User group to Jazz role mappings.

Note: Special Subjects like ALL_AUTHENTICATED_USERS or NESTED_GROUPS
would not work with JAS based deployments

## Configure Social Login in JAS to Redirect to Third Party OIDC Provider

We have the instructions for configuring JAS with a Third Party OIDC
Provider documented the the Article [Configure ELM Authentication with a
Third Party OIDC provider](JASandOIDCProvider).

The high level instructions are :

-   Create ClientId and Client Secret for JAS on the Third Party OIDC
    Provider
-   Add the redirect URL of format
    `https://[JAS_HOST]:[Port]/ibm/api/social-login/redirect/[ID]`
-   Enable the feature `socialLogin-1.0` in JAS `server.xml`
-   Add `oidcLogin` element to configure the connection to OIDC Provider
    in `appConfig.xml`
-   Configure Filters for Non-Web clients
-   Configure LDAP in JAS and JTS for User to group role mapping

Here is a sample configuration for Google OIDC Provider in
`[JAS_HOME]\wlp\usr\servers\jazzop\appConfig.xml`

socialLogin-1.0 appSecurity-2.0 ssl-1.0

-   The `clientId` and `clientSecret` are to be generated by your OIDC
    provider
-   The redirect URL points to the ID of your configured oidcLogin
    element and for the sample above the redirect URL is

[https://JAS_Host:Port/ibm/api/social-login/redirect/myoidcserver](https://JAS_Host:Port/ibm/api/social-login/redirect/myoidcserver)

## Configure Multiple OIDC Providers in JAS

The instructions are similar to the previous step. You add another
`oidcLogin` element with a unique `ID`, `displayName` and `Filter`.

Here is a sample configuration for multiple OIDC Providers

socialLogin-1.0 appSecurity-2.0 ssl-1.0

-   The `clientId` and `clientSecret` are to be generated by each OIDC
    provider
-   The redirect URL points to the ID of your configured oidcLogin
    element and for the sample above the redirect URLs from JAS are

1\.
[https://JAS_Host:Port/ibm/api/social-login/redirect/jas2exampleA](https://JAS_Host:Port/ibm/api/social-login/redirect/jas2exampleA)
2.
[https://JAS_Host:Port/ibm/api/social-login/redirect/jas2exampleB](https://JAS_Host:Port/ibm/api/social-login/redirect/jas2exampleB)
3.
[https://JAS_Host:Port/ibm/api/social-login/redirect/jas2exampleC](https://JAS_Host:Port/ibm/api/social-login/redirect/jas2exampleC)

## Liberty Default OIDC Providers Selection Form

When multiple OIDC Providers are configured to protect a request,
Liberty provides a default selection form that offers you the option to
choose between the available OIDC providers configured in the Liberty
server. Visit Liberty [Social Media Selection
Form](https://www.ibm.com/docs/en/was-liberty/core?topic=liberty-social-media-selection-form)
for additional information.

Here is the selection form for the sample provided in the previous step.
User can click on the Identity Provider for their Company.

## Configure Local Authentication as one of the Providers

You can configure [Socal Login Web
Application](https://www.ibm.com/docs/en/was-liberty/core?topic=SSD28V_liberty/com.ibm.websphere.liberty.autogen.nd.doc/ae/rwlp_config_socialLoginWebapp.htm)
to include Local Authentication in the Selection form.

Add the following configuration along with all the `oidcLogin`
configurations:

Here is the updated selection form when Local Authentication is included

##### Related topics: [Configure ELM Authentication with a Third Party OIDC provider](JASandOIDCProvider), [Jazz Authorization Server](JazzAuthorizationServer) [related-topics-configure-elm-authentication-with-a-third-party-oidc-provider-jazz-authorization-server]

##### External links: [external-links]

-   [IBM](https://www.ibm.com)

META:FILEATTACHMENT{name="oidc_provider_selection.png"
attachment="oidc_provider_selection.png" attr="h" comment=""
date="1642850961" path="oidc_provider_selection.png" size="40126"
user="shubjit" version="2"}
META:FILEATTACHMENT{name="selection_form_v1.png"
attachment="selection_form_v1.png" attr="h" comment="" date="1643709429"
path="selection_form_v1.png" size="40824" user="shubjit" version="1"}
META:FILEATTACHMENT{name="OIDC_Local_Auth.png"
attachment="OIDC_Local_Auth.png" attr="h" comment="" date="1700038151"
path="OIDC_Local_Auth.png" size="69493" user="shubjit" version="1"}
